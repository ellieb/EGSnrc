<!--
###############################################################################
#
#  EGSnrc online voxel and dose visualization tool
#  Copyright (C) 2020 Magdalena Bazalova-Carter and Elise Badun
#
#  This file is part of EGSnrc.
#
#  EGSnrc is free software: you can redistribute it and/or modify it under
#  the terms of the GNU Affero General Public License as published by the
#  Free Software Foundation, either version 3 of the License, or (at your
#  option) any later version.
#
#  EGSnrc is distributed in the hope that it will be useful, but WITHOUT ANY
#  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
#  FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for
#  more details.
#
#  You should have received a copy of the GNU Affero General Public License
#  along with EGSnrc. If not, see <http://www.gnu.org/licenses/>.
#
###############################################################################
#
#  Author:          Elise Badun, 2020
#
#  Contributors:
#
###############################################################################
-->


<!DOCTYPE html>
<html>
  <head>
    <title>UVic Dose Dig</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://x3dom.org/download/dev/x3dom-full.js"></script>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://raw.githack.com/jamesleesaunders/d3-x3d/master/dist/d3-x3d.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.js"></script>
    <script async src="http://cdn.jsdelivr.net/g/filesaver.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
  </head>
  <body>
    <div class="header">
      <h1>UVic Dose Dig</h1>
      <img src="./images/logo.jpg" alt="XCITE Lab logo" />
    </div>
    <p class="description">Upload your own .egsphant and .3ddose files.</p>
    <div id="drop-area">
      <p>
        Drop or select one or more .egsphant and .3ddose files or use existing
        <button id="test-files" class="link-appearance">test files</button>.
      </p>
      <input type="file" id="file-input" multiple accept=".egsphant, .3ddose" />
      <br />
      <progress id="progress-bar" max="100" value="0" class="hidden"></progress>
    </div>
    <div id="dose-viewer-container" class="container">
      <span id="dose-viewer-info-container" class="container">
        <div id="axis-slider-container"></div>
      </span>
      <span class="container">
        <button id="save-vis" disabled>Export visualization to PNG</button>
        <br />
        <button id="save-dose-profile" disabled>
          Export dose profiles to CSV
        </button>
        <br />
        <input
          type="checkbox"
          id="show-marker-checkbox"
          name="show-marker-checkbox"
          value="ShowMarker"
          disabled
        />
        <label for="show-marker-checkbox">
          Show voxel information on click?
        </label>
        <br />
        <br />
        <input
          type="checkbox"
          id="show-dose-profile-checkbox"
          name="show-dose-profile-checkbox"
          value="ShowDoseProfile"
          disabled
        />
        <label for="show-dose-profile-checkbox">
          Plot dose profile at crosshairs?
        </label>
        <br />

        <input
          type="checkbox"
          id="density-profile-checkbox"
          name="density-profile-checkbox"
          value="PlotDensity"
          style="display: none"
          disabled
        />
        <label for="density-profile-checkbox" style="display: none">
          Plot density?
        </label>
        <br />
      </span>
      <div id="image-to-print"></div>
      <button id="add-volume-viewer" style="display: none">
        Add new volume viewer
      </button>
    </div>
    <script type="text/javascript" src="./volume.js"></script>
    <script type="text/javascript" src="./dose-profile.js"></script>
    <script type="text/javascript" src="./zoom.js"></script>
    <script type="text/javascript" src="./panel.js"></script>
    <script type="text/javascript" src="./slider.js"></script>
    <script type="text/javascript" src="./voxel-coordinates.js"></script>
    <script type="text/javascript" src="./volume-viewer.js"></script>
    <script>
      // TODO: Move all javascript outside of index.html
      // TODO: Make add new volume viewer button work

      // Define all size variables
      const mainViewerDimensions = {
        fullWidth: 320,
        fullHeight: 320,
        margin: { top: 20, right: 15, bottom: 50, left: 55 },
        get width() {
          return this.fullWidth - this.margin.left - this.margin.right;
        },
        get height() {
          return this.fullHeight - this.margin.top - this.margin.bottom;
        },
      };

      // Define legend size variables
      const legendDimensions = {
        fullWidth: 90,
        fullHeight: mainViewerDimensions.fullHeight,
        margin: { top: 25, right: 10, bottom: 25, left: 10 },
        get width() {
          return this.fullWidth - this.margin.left - this.margin.right;
        },
        get height() {
          return this.fullHeight - this.margin.top - this.margin.bottom;
        },
      };

      // Define profile dose size variables
      const sideDoseProfileDimensions = {
        fullWidth: mainViewerDimensions.fullWidth,
        fullHeight: mainViewerDimensions.fullHeight * 0.6,
        margin: { top: 30, right: 15, bottom: 30, left: 55 },
        get width() {
          return this.fullWidth - this.margin.left - this.margin.right;
        },
        get height() {
          return this.fullHeight - this.margin.top - this.margin.bottom;
        },
      };

      // Global variables
      // TODO: Make a global dimensions list [x, y, z]
      // TODO: Make use of global axes list throughout code
      const axes = ["xy", "yz", "xz"];
      var densityVolumeList = [];
      var doseVolumeList = [];
      var doseComparisonVolumeList = [];
      var volumeViewerList = [];
    </script>
    <script type="text/javascript" src="./window-level-slider.js"></script>
    <script type="text/javascript" src="./file-upload.js"></script>
    <script type="text/javascript" src="./export.mjs"></script>
    <script type="text/javascript" src="./read-data.js"></script>
    <script type="text/javascript" src="./checkbox-button-helper.js"></script>
  </body>
</html>
